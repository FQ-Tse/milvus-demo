# milvus-demo
Milvus Learning and Using

## Search 和 Query 的核心区别

| **比较点**       | **Search**                                    | **Query**                                     |
|------------------|-----------------------------------------------|-----------------------------------------------|
| **是否基于向量** | 是，基于向量相似性检索                        | 否，只基于字段值的条件筛选                    |
| **是否排序**     | 按相似性分数排序                               | 无排序，结果顺序与存储顺序一致                |
| **输入要求**     | 必需提供查询向量                              | 只需提供过滤条件                              |
| **返回控制**     | 按相似性排序后，返回 limit 个最近邻结果       | 返回满足条件的所有记录（或限制条数）          |
| **主要用途**     | 语义搜索、推荐系统、图像/文本检索等场景        | 数据筛选、统计、条件查找                      |



# `metric_type` 参数及其作用

`metric_type` 用于指定向量检索时的距离度量方式，以下是支持的选项及其对应作用：

| 参数名       | 中文描述                     | 主要作用                               | 示例应用场景                  |
| ------------ | ---------------------------- | -------------------------------------- | ----------------------------- |
| **L2**       | 欧几里得距离（平方距离）      | 衡量两个向量之间的空间距离             | 图像检索、定位相关场景        |
| **IP**       | 内积                         | 测量向量之间的相似性（越大越相似）     | 推荐系统、用户偏好建模        |
| **COSINE**   | 余弦相似度                   | 衡量向量方向的一致性（值越接近 1 越相似） | 文本语义匹配、自然语言处理    |
| **HAMMING**  | 汉明距离                     | 测量二进制向量之间的位差（非连续数值） | 基因序列分析、二进制特征分析 |
| **JACCARD**  | 杰卡德相似度（集合相似性）   | 衡量两个集合的交集与并集比值           | 推荐算法、标签重叠分析        |
| **TANIMOTO** | Tanimoto 系数                | Jaccard 相似度的变体，用于浮点特征     | 化学分子相似性、特征聚类分析 |
| **SUPERSTRUCTURE** | 超结构比较（化学领域） | 检测化学分子之间是否具有超结构关系     | 药物发现、化学分子结构分析    |
| **SUBSTRUCTURE**  | 子结构比较（化学领域）   | 检测化学分子是否为另一分子的子结构     | 化学子结构分析、特征搜索      |

---

## 示例

```javascript
const createIndex = await milvusClient.createIndex({
    collection_name: 'example_collection',
    field_name: 'vector',
    metric_type: 'COSINE', // 使用余弦相似度
    index_type: 'HNSW',
    params: { efConstruction: 200 },
});
```
---

# `index_type` 支持的索引类型及其使用场景

`index_type` 决定了向量数据的索引方式，以下是常见索引类型的说明及适用场景：

| 索引类型       | 中文描述                  | 主要用途                              | 使用场景                      |
| -------------- | ------------------------- | ------------------------------------- | ----------------------------- |
| **FLAT**       | 暴力搜索（线性扫描）      | 遍历所有向量进行检索，无数据分区优化  | 小规模数据集（<10万向量）      |
| **IVF_FLAT**   | 倒排文件 + 暴力搜索       | 向量分桶后，在候选集中暴力搜索        | 大规模数据（>10万向量），适合内存充裕的场景 |
| **IVF_SQ8**    | 倒排文件 + 紧凑量化      | 数据分桶后量化，降低内存占用          | 大规模检索，内存有限时选择    |
| **IVF_PQ**     | 倒排文件 + 产品量化      | 数据分桶后产品量化，进一步减少内存消耗 | 超大规模数据集（>百万向量）    |
| **HNSW**       | 基于图的最近邻搜索        | 使用图结构优化查询路径               | 高效检索，高维度数据场景      |
| **RHNSW_FLAT** | 基于图的暴力搜索          | 图检索 + 暴力搜索                    | 更精确的结果，高计算能力场景  |
| **RHNSW_SQ**   | 基于图的紧凑量化         | 图检索 + 量化                        | 计算能力有限的场景            |
| **RHNSW_PQ**   | 基于图的产品量化         | 图检索 + 产品量化                    | 大规模数据场景，内存受限场景  |
| **BIN_FLAT**   | 二进制向量的暴力搜索      | 对二进制向量逐一比较                 | 基因序列分析，二进制特征检索 |

---

## 示例

```javascript
const createIndex = await milvusClient.createIndex({
    collection_name: 'sample_collection',
    field_name: 'vector',
    index_type: 'HNSW', // 使用 HNSW 索引
    metric_type: 'COSINE',
    params: { efConstruction: 200 }, // HNSW 特有参数
});
```


---

# `index_type` 比较：FLAT, IVF_FLAT 和 HNSW

下面是 `FLAT`、`IVF_FLAT` 和 `HNSW` 索引类型的比较：

| 比较项         | FLAT       | IVF_FLAT     | HNSW        |
| -------------- | ---------- | ------------ | ----------- |
| 数据规模支持    | 小规模     | 中等规模     | 大规模       |
| 查询速度       | 慢         | 较快         | 很快         |
| 内存使用       | 高         | 较高         | 较低         |
| 构建时间       | 无需构建   | 较快         | 较慢         |
| 使用场景       | 精确搜索   | 规模较大的场景 | 大规模高效搜索 |

---

### **Summary**

- **FLAT**: 适用于小规模数据集，提供精确搜索，但查询速度较慢，内存使用较高。
- **IVF_FLAT**: 适合中等规模数据集，提供较快的查询速度，但内存和构建时间较高。
- **HNSW**: 适用于大规模数据集，具有非常快的查询速度，并且内存使用较低，但构建时间较慢。

